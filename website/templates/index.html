<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/styles.css">
    <title>Teste de percepção de codecs</title>
  </head>

<body>
    <h1>Avaliação de percepção de áudio</h1>
      <h2>Instruções:</h2>
        <p>Esse procedimento de percepção de áudio faz uso de uma simplificação do método <a href="https://www.itu.int/dms_pubrec/itu-r/rec/bs/R-REC-BS.1534-3-201510-I!!PDF-E.pdf">MUSHRA</a>. Os principais pontos que você deve observar ao realizar o teste são:</p>
          <ul>
            <li>Você deve dar uma <em>nota pra qualidade do áudio de 0 a 100</em> usando a barra deslizante de cada um;</li>
            <li>O primeiro áudio -- áudio de referência -- possui qualidade máxima. Use ele para comparar com os outros áudios;</li>
            <li>Os outros áudios estão em ordem aleatória;</li>
            <li>Você é encorajado a comparar os áudios entre eles para determinar qual é melhor e dar a nota de acordo;</li>
            <li>Esteja atento para identificar ruídos e artefatos nos aúdios;</li>
          </ul>

        <p>Obrigado pela participação. Bom teste!</p>
      <hr>

      <h2>Informações do participante:</h2>
        <p>Essas informações serão utilizadas para análise estatística dos resultados.</p>
          <form>
            <label for="initials">Insira suas Iniciais:</label>
            <input type="text" id="initials" name="initials" placeholder="JS (ex. João Silva)"><br>

            <label for="age">Insira sua idade:</label>
            <input type="text" id="age" name="age" placeholder="30"><br>

            <label for="profession">Insira sua profissão:</label>
            <input type="text" id="profession" name="profession" placeholder="Engenheiro de Software"><br>

            <label for="date">Data em que o teste foi realizado:</label>
            <input type="date" id="date" name="date"><br>
          </form>
      <hr>

      <h2>Análise de áudio:</h2>
      <div class="audio-container">
        <h3>Áudio referência:</h3>
          <p>Esse áudio é o original com qualidade máxima, escute ele sempre que necessário para comparar com os outros arquivos de áudio fornecidos.</p>

          <audio controls>
              <source src="/audio/piano1.wav" type="audio/wav">
              Your browser does not support the audio element.
          </audio>     

          <p>Ajuste o slider para que o valor desse áudio seja 100:</p>

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 1:</h3>

          <audio controls>
              <source src="/audio/aac/piano1_1.aac" type="audio/aac">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 2:</h3>

          <audio controls>
              <source src="/audio/aac/piano1_2.aac" type="audio/aac">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 3:</h3>

          <audio controls>
              <source src="/audio/aac/piano1_3.aac" type="audio/aac">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 4:</h3>

          <audio controls>
              <source src="/audio/mp3/piano1_1.mp3" type="audio/mpeg">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 5:</h3>

          <audio controls>
              <source src="/audio/mp3/piano1_2.mp3" type="audio/mpeg">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 6:</h3>

          <audio controls>
              <source src="/audio/mp3/piano1_3.mp3" type="audio/mpeg">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 7:</h3>

          <audio controls>
              <source src="/audio/ogg/piano1_1.ogg" type="audio/ogg">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 8:</h3>

          <audio controls>
              <source src="/audio/ogg/piano1_2.ogg" type="audio/ogg">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

      <div class="audio-container">
        <h3>Áudio 9:</h3>

          <audio controls>
              <source src="/audio/ogg/piano1_3.ogg" type="audio/ogg">
              Your browser does not support the audio element.
          </audio>     

          <div class="slider-group">
            <label>Nota: <span class="slider-value">50</span></label>
            <input type="range" class="slider" min="0" max="100" value="50">
          </div>
      </div>

  <button id="submitBtn">Enviar respostas</button>

  <script>
    const sliders = document.querySelectorAll('.slider');

    sliders.forEach(slider => {
      const valueDisplay = slider.previousElementSibling.querySelector('.slider-value');
      valueDisplay.textContent = slider.value;

      slider.addEventListener('input', () => {
        valueDisplay.textContent = slider.value;
      });
    });

    document.getElementById('submitBtn').addEventListener('click', () => {
      // Captura os dados do participante
      const initials = document.getElementById('initials').value;
      const idade = parseInt(document.getElementById('age').value);
      const profession = document.getElementById('profession').value;
      const created_at = document.getElementById('date').value;

      // Captura os valores dos sliders e monta as notas
      const notas = {};
      sliders.forEach((slider, index) => {
        notas[`nota_${index}`] = parseInt(slider.value);
      });

      // Monta o dicionário final
      const dados = {
        initials: initials,
        idade: idade,
        profession: profession,
        created_at: created_at,
        ...notas
      };

      console.log("Dicionário formatado para o servidor:", dados);

      fetch('/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dados)
        })
        .then(response => response.json())
        .then(data => {
          console.log("Resposta do servidor:", data);
          alert("Respostas enviadas com sucesso!");
        })
        .catch(error => {
          console.error("Erro ao enviar dados:", error);
          alert("Erro ao enviar os dados.");
      });

      // Aqui você pode enviar com fetch, se quiser:
      // fetch('/seu-endpoint', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify(dados)
      // });
    });
  </script>

</body>

  <footer>
  <p>© 2025 UFABC - Codificação de Sinais Multimídia</p>
  <p>Desenvolvido pelo grupo de alunos:</p>
  <ul class="footer-list">
    <li>Murilo Preto, 11202130882</li>
    <li>Murilo Alves, 11202130884</li>
    <li>João, 11</li>
  </ul>
</footer>

</html>
